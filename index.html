<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å»ºç¯‰æ³•è¦èª¿æŸ»ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Yu Gothic', 'Meiryo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #1e3c72;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step-badge {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
            font-family: 'Segoe UI', 'Yu Gothic', 'Meiryo', sans-serif;
        }

        .input-group textarea {
            min-height: 300px;
            resize: vertical;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            text-decoration: none;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(23, 162, 184, 0.4);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        #map {
            width: 100%;
            height: 500px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #0066cc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
        }

        .coordinate-display {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
            line-height: 1.8;
        }

        .coordinate-display strong {
            color: #856404;
        }

        .gis-link-section {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            color: white;
            margin-top: 20px;
        }

        .gis-link-section h3 {
            font-size: 20px;
            margin-bottom: 15px;
        }

        .gis-info {
            font-size: 16px;
            margin-bottom: 20px;
            opacity: 0.95;
        }

        .alert-info {
            background: #cfe2ff;
            border: 1px solid #b6d4fe;
            color: #084298;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 13px;
        }

        .alert-success {
            background: #d1e7dd;
            border: 1px solid #a3cfbb;
            color: #0a3622;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 13px;
        }

        .formatted-output {
            background: #ffffff;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 20px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.8;
            max-height: 500px;
            overflow-y: auto;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 968px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            #map {
                height: 400px;
            }
            
            .header h1 {
                font-size: 22px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ï¸ å»ºç¯‰æ³•è¦èª¿æŸ»ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p>åœ°å›³ã§åœ°ç‚¹ã‚’é¸æŠ â†’ è‡ªæ²»ä½“GISã‚µã‚¤ãƒˆã§æƒ…å ±å–å¾— â†’ ãƒ†ã‚­ã‚¹ãƒˆæ•´å½¢</p>
        </div>

        <div class="main-content">
            <!-- ã‚¹ãƒ†ãƒƒãƒ—1: ä½æ‰€æ¤œç´¢ -->
            <div class="section">
                <div class="section-title">
                    <span class="step-badge">1</span>
                    ä½æ‰€æ¤œç´¢ãƒ»åœ°å›³è¡¨ç¤º
                </div>
                
                <div class="input-group">
                    <label>ğŸ“ èª¿æŸ»å¯¾è±¡ã®ä½æ‰€ã‚’å…¥åŠ›</label>
                    <input type="text" id="addressInput" placeholder="ä¾‹: æ±äº¬éƒ½åƒä»£ç”°åŒºä¸¸ã®å†…1-1-1">
                </div>
                
                <button class="btn btn-primary" onclick="searchAddress()">
                    ğŸ” ä½æ‰€æ¤œç´¢
                </button>

                <div class="alert-info" style="margin-top: 15px;">
                    ğŸ’¡ åœ°å›³ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã€èª¿æŸ»ã—ãŸã„åœ°ç‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„
                </div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—2: åœ°å›³ -->
            <div class="section">
                <div class="section-title">
                    <span class="step-badge">2</span>
                    åœ°å›³ä¸Šã§åœ°ç‚¹ã‚’é¸æŠ
                </div>
                <div id="map"></div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—3: åº§æ¨™æƒ…å ±ã¨GISãƒªãƒ³ã‚¯ -->
            <div id="coordinateInfo" class="coordinate-display" style="display: none;">
                <strong>ğŸ“Œ é¸æŠåœ°ç‚¹ã®æƒ…å ±:</strong><br>
                ç·¯åº¦: <span id="latDisplay">-</span><br>
                çµŒåº¦: <span id="lngDisplay">-</span><br>
                è‡ªæ²»ä½“: <span id="municipalityDisplay" style="font-size: 18px; font-weight: bold; color: #d9534f;">-</span>
            </div>

            <div id="gisLinkSection" class="gis-link-section" style="display: none;">
                <h3>ğŸ—ºï¸ è‡ªæ²»ä½“ã®éƒ½å¸‚è¨ˆç”»æƒ…å ±ã‚µã‚¤ãƒˆ</h3>
                <div class="gis-info">
                    <strong id="gisCity">-</strong> ã®éƒ½å¸‚è¨ˆç”»æƒ…å ±ã‚’ç¢ºèªã§ãã¾ã™
                </div>
                <button class="btn btn-success" onclick="openGISLink()">
                    ğŸ“‚ <span id="gisCityName">è‡ªæ²»ä½“</span>GISã‚µã‚¤ãƒˆã‚’é–‹ã
                </button>
                <div class="alert-info" style="margin-top: 15px;">
                    âœ¨ GISã‚µã‚¤ãƒˆã§ç”¨é€”åœ°åŸŸãƒ»å®¹ç©ç‡ãªã©ã‚’ç¢ºèªã—ã€æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä¸‹ã®æ¬„ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
                </div>
            </div>

            <!-- ã‚¹ãƒ†ãƒƒãƒ—4: GISæƒ…å ±æ•´å½¢ -->
            <div class="section">
                <div class="section-title">
                    <span class="step-badge">3</span>
                    GISæƒ…å ±ã®æ•´å½¢
                </div>
                
                <div class="input-group">
                    <label>ğŸ“‹ GISã‚µã‚¤ãƒˆã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸæƒ…å ±ã‚’è²¼ã‚Šä»˜ã‘</label>
                    <textarea id="gisRawInput" placeholder="ä¾‹:&#10;ã€Aã€‘ç”¨é€”åœ°åŸŸç­‰&#10;éƒ½å¸‚è¨ˆç”»åŒºåŸŸ	éƒ½å¸‚è¨ˆç”»åŒºåŸŸå†…&#10;åŒºåŸŸåŒºåˆ†	å¸‚è¡—åŒ–åŒºåŸŸ&#10;ç”¨é€”åœ°åŸŸ	å•†æ¥­åœ°åŸŸ&#10;å®¹ç©ç‡	700 %&#10;..."></textarea>
                </div>
                
                <button class="btn btn-info" onclick="formatGISInfo()">
                    âœ¨ ãƒ†ã‚­ã‚¹ãƒˆã‚’æ•´å½¢ã™ã‚‹
                </button>
                <button class="btn btn-primary" onclick="copyFormatted()">
                    ğŸ“„ æ•´å½¢çµæœã‚’ã‚³ãƒ”ãƒ¼
                </button>

                <div class="alert-info">
                    ğŸ’¡ ã‚³ãƒ”ãƒ¼ã—ãŸæƒ…å ±ã‚’ã€Œé …ç›®åï¼šå€¤ã€å½¢å¼ã«è‡ªå‹•æ•´å½¢ã—ã¾ã™
                </div>

                <div id="formattedOutput" class="formatted-output" style="display: none;"></div>
                <div id="copySuccess" class="alert-success" style="display: none;">
                    âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼
                </div>
            </div>
        </div>
    </div>

    <script>
        let map;
        let marker;
        let currentLat = null;
        let currentLng = null;
        let currentMunicipality = null;
        let formattedText = '';

        // å…¨è‡ªæ²»ä½“ã®GISã‚µã‚¤ãƒˆURLï¼ˆå‰Šé™¤å³ç¦ï¼‰
        const gisDatabase = {
            'åƒä»£ç”°åŒº': {
                url: 'https://tokei-gis1.chiyodatoshikei.jp/toshikei/apps/experiencebuilder/experience/?id=63107f3af4d64dfbaca424799059a7bd',
                name: 'åƒä»£ç”°åŒºéƒ½å¸‚è¨ˆç”»æƒ…å ±ã‚µãƒ¼ãƒ“ã‚¹'
            },
            'ä¸­å¤®åŒº': {
                url: 'https://chuo-map.jp/top.php',
                name: 'ä¸­å¤®åŒºåœ°å›³æƒ…å ±ã‚µãƒ¼ãƒ“ã‚¹'
            },
            'æ¸¯åŒº': {
                url: 'https://www.sonicweb-asp.jp/minato/',
                name: 'æ¸¯åŒºéƒ½å¸‚è¨ˆç”»æƒ…å ±ã‚µãƒ¼ãƒ“ã‚¹'
            },
            'æ–°å®¿åŒº': {
                url: 'https://www.sonicweb-asp.jp/shinjuku2/',
                name: 'æ–°å®¿åŒºéƒ½å¸‚è¨ˆç”»æƒ…å ±ã‚µãƒ¼ãƒ“ã‚¹'
            },
            'æ–‡äº¬åŒº': {
                url: 'https://www.sonicweb-asp.jp/bunkyo-youto/',
                name: 'æ–‡äº¬åŒºéƒ½å¸‚è¨ˆç”»æƒ…å ±æä¾›ã‚µãƒ¼ãƒ“ã‚¹'
            },
            'å°æ±åŒº': {
                url: 'https://www2.wagmap.jp/taito/PositionSelect?mid=2',
                name: 'å°æ±åŒºéƒ½å¸‚è¨ˆç”»æƒ…å ±æä¾›ã‚µãƒ¼ãƒ“ã‚¹'
            },
            'å¢¨ç”°åŒº': {
                url: 'https://www.sonicweb-asp.jp/sumida/',
                name: 'å¢¨ç”°åŒºã¾ã¡ã¥ãã‚Šãƒãƒƒãƒ—'
            },
            'æ±Ÿæ±åŒº': {
                url: 'https://koto.geocloud.jp/',
                name: 'æ±Ÿæ±åŒºã“ã¨ã¾ã£ã·'
            },
            'å“å·åŒº': {
                url: 'https://www2.wagmap.jp/shinagawa/Map',
                name: 'å“å·åŒºã—ãªãŒã‚MAP'
            },
            'ç›®é»’åŒº': {
                url: 'https://www.sonicweb-asp.jp/meguro/',
                name: 'ç›®é»’åŒºã‚ãã‚åœ°å›³æƒ…å ±ã‚µãƒ¼ãƒ“ã‚¹'
            },
            'å¤§ç”°åŒº': {
                url: 'https://www2.wagmap.jp/ota/Portal',
                name: 'å¤§ç”°åŒºã¾ã¡ãƒãƒƒãƒ—ãŠãŠãŸ'
            },
            'ä¸–ç”°è°·åŒº': {
                url: 'https://www.sonicweb-asp.jp/setagaya/',
                name: 'ä¸–ç”°è°·åŒºã›ãŸãŒã‚„iMap'
            },
            'æ¸‹è°·åŒº': {
                url: 'https://www2.wagmap.jp/shibuya/PositionSelect?mid=1000',
                name: 'æ¸‹è°·åŒºåœ°å›³æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ '
            },
            'ä¸­é‡åŒº': {
                url: 'https://www2.wagmap.jp/nakanodatamap/PositionSelect?mid=62',
                name: 'ä¸­é‡åŒºãªã‹ã®ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ—'
            },
            'æ‰ä¸¦åŒº': {
                url: 'https://www2.wagmap.jp/suginami/PositionSelect?mid=2',
                name: 'æ‰ä¸¦åŒºã™ããƒŠãƒ“'
            },
            'è±Šå³¶åŒº': {
                url: 'https://www2.wagmap.jp/toshima/PositionSelect?mid=2',
                name: 'è±Šå³¶åŒºåœ°å›³æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ '
            },
            'åŒ—åŒº': {
                url: 'https://www2.wagmap.jp/kitaku-sp/MapPage?dtp=2',
                name: 'åŒ—åŒºåœ°å›³æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ '
            },
            'è’å·åŒº': {
                url: 'https://www2.wagmap.jp/arakawa/Portal',
                name: 'è’å·åŒºåœ°å›³æƒ…å ±'
            },
            'æ¿æ©‹åŒº': {
                url: 'https://itabashi.geocloud.jp/webgis/',
                name: 'æ¿æ©‹åŒºéƒ½å¸‚è¨ˆç”»æƒ…å ±ãƒãƒƒãƒ—'
            },
            'ç·´é¦¬åŒº': {
                url: 'https://www.sonicweb-asp.jp/nerimap/',
                name: 'ç·´é¦¬åŒºåœ°å›³æƒ…å ±ã­ã‚Šã¾ã£ã·'
            },
            'è¶³ç«‹åŒº': {
                url: 'https://www.sonicweb-asp.jp/adachi2/',
                name: 'è¶³ç«‹åŒºã‚ã ã¡åœ°å›³æƒ…å ±æä¾›ã‚µãƒ¼ãƒ“ã‚¹'
            },
            'è‘›é£¾åŒº': {
                url: 'https://www.sonicweb-asp.jp/katsushika/',
                name: 'è‘›é£¾åŒºã‹ã¤ã—ã‹é›»å­ã¾ã£ã·'
            },
            'æ±Ÿæˆ¸å·åŒº': {
                url: 'https://www2.wagmap.jp/edogawa/Portal',
                name: 'æ±Ÿæˆ¸å·åŒºéƒ½å¸‚è¨ˆç”»ãƒ»æŒ‡å®šé“è·¯æƒ…å ±æä¾›ã‚µãƒ¼ãƒ“ã‚¹'
            },
            // ãã®ä»–ä¸»è¦éƒ½å¸‚
            'å·å´å¸‚': {
                url: 'https://kawasaki.geocloud.jp/webgis/',
                name: 'å·å´å¸‚éƒ½å¸‚è¨ˆç”»æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ '
            },
            'æ¨ªæµœå¸‚': {
                url: 'https://wwwm.city.yokohama.lg.jp/yokohama/Portal',
                name: 'æ¨ªæµœå¸‚è¡Œæ”¿åœ°å›³æƒ…å ±æä¾›ã‚·ã‚¹ãƒ†ãƒ '
            },
            'å¤§é˜ªå¸‚': {
                url: 'https://www.city.osaka.lg.jp/toshikeikaku/page/0000370574.html',
                name: 'å¤§é˜ªå¸‚éƒ½å¸‚è¨ˆç”»æƒ…å ±æä¾›ã‚·ã‚¹ãƒ†ãƒ '
            },
            'åå¤å±‹å¸‚': {
                url: 'http://www.tokei.city.nagoya.jp/map/',
                name: 'åå¤å±‹å¸‚éƒ½å¸‚è¨ˆç”»æƒ…å ±æä¾›ã‚·ã‚¹ãƒ†ãƒ '
            },
            'ç¦å²¡å¸‚': {
                url: 'https://webmap.city.fukuoka.lg.jp/fukuoka/',
                name: 'ç¦å²¡å¸‚Webã¾ã£ã·'
            },
            'æœ­å¹Œå¸‚': {
                url: 'https://www.city.sapporo.jp/keikaku/keikaku/gis/gis.html',
                name: 'æœ­å¹Œå¸‚éƒ½å¸‚è¨ˆç”»æƒ…å ±æä¾›ã‚µãƒ¼ãƒ“ã‚¹'
            },
            'äº¬éƒ½å¸‚': {
                url: 'https://www2.wagmap.jp/kyoto/Portal',
                name: 'äº¬éƒ½å¸‚éƒ½å¸‚è¨ˆç”»æƒ…å ±ç­‰æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ '
            },
            'ç¥æˆ¸å¸‚': {
                url: 'https://www2.wagmap.jp/kobe/Portal',
                name: 'ç¥æˆ¸å¸‚éƒ½å¸‚è¨ˆç”»æƒ…å ±ãƒãƒƒãƒ—'
            },
            'åƒè‘‰å¸‚': {
                url: 'https://www.city.chiba.jp/toshi/toshi/keikaku/gis.html',
                name: 'åƒè‘‰å¸‚éƒ½å¸‚è¨ˆç”»æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ '
            },
            // ç¥å¥ˆå·çœŒä¸»è¦éƒ½å¸‚
            'ç›¸æ¨¡åŸå¸‚': {
                url: 'https://sagamihara.geocloud.jp/webgis/?p=1',
                name: 'ã•ãŒã¿ã¯ã‚‰åœ°å›³æƒ…å ±'
            },
            'è—¤æ²¢å¸‚': {
                url: 'https://webgis.alandis.jp/fujisawa14/210/portal/',
                name: 'ãµã˜ã•ã‚ã‚­ãƒ¥ãƒ³ãƒãƒƒãƒ—'
            },
            'æ¨ªé ˆè³€å¸‚': {
                url: 'https://www2.wagmap.jp/yokosuka/Portal',
                name: 'ã‚ˆã“ã™ã‹ã‚ãŒè¡—ã‚¬ã‚¤ãƒ‰'
            },
            'èŒ…ãƒ¶å´å¸‚': {
                url: 'https://www2.wagmap.jp/chigasaki/Portal',
                name: 'ã¾ã£ã·deã¡ãŒã•ã'
            },
            'å¹³å¡šå¸‚': {
                url: 'https://webgis.alandis.jp/hiratsuka14/',
                name: 'ã²ã‚‰ã¤ã‹ã‚ãã‚ããƒãƒƒãƒ—'
            },
            'å¤§å’Œå¸‚': {
                url: 'https://www.machi-info.jp/machikado/yamato_city/consentpage/gis-toshi.html',
                name: 'å¤§å’Œå¸‚éƒ½å¸‚è¨ˆç”»ãƒãƒƒãƒ—'
            },
            // åŸ¼ç‰çœŒä¸»è¦éƒ½å¸‚
            'ã•ã„ãŸã¾å¸‚': {
                url: 'https://www.sonicweb-asp.jp/saitama/',
                name: 'ã•ã„ãŸã¾å¸‚åœ°å›³æƒ…å ±'
            },
            'å·å£å¸‚': {
                url: 'https://kawaguchi.geocloud.jp/webgis/?bt=0&p=1',
                name: 'ã‹ã‚ãã¡æ¡ˆå†…ãƒãƒƒãƒ—'
            },
            'å·è¶Šå¸‚': {
                url: 'http://www2.wagmap.jp/kawagoe-sp/index.asp',
                name: 'å°æ±Ÿæˆ¸å·è¶Šãƒãƒƒãƒ—'
            },
            'æ‰€æ²¢å¸‚': {
                url: 'https://webgis.alandis.jp/tokorozawa11/alandis/webgis/',
                name: 'æ‰€æ²¢å¸‚åœ°ç†æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ '
            },
            // åƒè‘‰çœŒä¸»è¦éƒ½å¸‚
            'èˆ¹æ©‹å¸‚': {
                url: 'https://webgis.alandis.jp/funabashi12/portal/',
                name: 'èˆ¹æ©‹IKIIKIãµã‚Œã‚ã„ãƒãƒƒãƒ—'
            },
            'æŸå¸‚': {
                url: 'https://www.sonicweb-asp.jp/kashiwa/',
                name: 'æŸå¸‚å…¬é–‹å‹GIS'
            },
            'æ¾æˆ¸å¸‚': {
                url: 'https://www.sonicweb-asp.jp/matsudo/',
                name: 'ã‚„ã•ã‚·ãƒ†ã‚£ãƒãƒƒãƒ—'
            },
            'å¸‚å·å¸‚': {
                url: 'https://gis.city.ichikawa.lg.jp/webgis/?bt=0&p=1',
                name: 'ã„ã¡æ¡ˆå†…'
            }
        };

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 35.6812, lng: 139.7671 },
                zoom: 13,
                mapTypeControl: true,
                streetViewControl: true,
                fullscreenControl: true
            });

            map.addListener('click', function(event) {
                placeMarker(event.latLng);
            });
        }

        function placeMarker(location) {
            if (marker) {
                marker.setMap(null);
            }

            marker = new google.maps.Marker({
                position: location,
                map: map,
                animation: google.maps.Animation.DROP
            });

            currentLat = location.lat();
            currentLng = location.lng();

            document.getElementById('latDisplay').textContent = currentLat.toFixed(6);
            document.getElementById('lngDisplay').textContent = currentLng.toFixed(6);
            document.getElementById('coordinateInfo').style.display = 'block';

            reverseGeocode(currentLat, currentLng);
        }

        function searchAddress() {
            const address = document.getElementById('addressInput').value;
            
            if (!address) {
                alert('ä½æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const geocoder = new google.maps.Geocoder();
            geocoder.geocode({ address: address }, function(results, status) {
                if (status === 'OK') {
                    map.setCenter(results[0].geometry.location);
                    map.setZoom(17);
                    placeMarker(results[0].geometry.location);
                } else {
                    alert('ä½æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ: ' + status);
                }
            });
        }

        function reverseGeocode(lat, lng) {
            const geocoder = new google.maps.Geocoder();
            const latlng = { lat: lat, lng: lng };

            geocoder.geocode({ location: latlng }, function(results, status) {
                if (status === 'OK' && results[0]) {
                    let municipality = null;

                    for (const component of results[0].address_components) {
                        if (component.types.includes('locality') && component.types.includes('political')) {
                            municipality = component.long_name;
                            break;
                        }
                        if (component.types.includes('ward') && component.types.includes('political')) {
                            municipality = component.long_name;
                            break;
                        }
                    }

                    if (municipality) {
                        currentMunicipality = municipality;
                        document.getElementById('municipalityDisplay').textContent = municipality;

                        if (gisDatabase[municipality]) {
                            document.getElementById('gisCity').textContent = municipality;
                            document.getElementById('gisCityName').textContent = municipality;
                            document.getElementById('gisLinkSection').style.display = 'block';
                        } else {
                            document.getElementById('gisLinkSection').style.display = 'none';
                            alert('âš ï¸ ' + municipality + 'ã®GISã‚µã‚¤ãƒˆæƒ…å ±ã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                        }
                    }
                }
            });
        }

        function openGISLink() {
            if (currentMunicipality && gisDatabase[currentMunicipality]) {
                const gisUrl = gisDatabase[currentMunicipality].url;
                window.open(gisUrl, '_blank');
            } else {
                alert('è‡ªæ²»ä½“GISã‚µã‚¤ãƒˆã®æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
        }

        function formatGISInfo() {
            const rawText = document.getElementById('gisRawInput').value;
            
            if (!rawText.trim()) {
                alert('GISæƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            // ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡Œå˜ä½ã§å‡¦ç†
            const lines = rawText.split('\n');
            let formatted = [];
            let currentKey = null;
            let previousWasKey = false;

            for (let i = 0; i < lines.length; i++) {
                let line = lines[i].trim();
                
                // ç©ºè¡Œã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³é–“ã®åŒºåˆ‡ã‚Šã¨ã—ã¦1ã¤è¿½åŠ ï¼‰
                if (!line) {
                    if (formatted.length > 0 && formatted[formatted.length - 1] !== '') {
                        formatted.push('');
                    }
                    currentKey = null;
                    previousWasKey = false;
                    continue;
                }

                // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆã€Aã€‘ãªã©ï¼‰ã‚’æ¤œå‡º
                if (line.match(/^ã€[A-Z]ã€‘/)) {
                    if (formatted.length > 0) formatted.push('');
                    formatted.push(line);
                    currentKey = null;
                    previousWasKey = false;
                    continue;
                }

                // ã€Œâ€»ã€ã€Œèª¬æ˜ã€ã€ŒURLã€ã§å§‹ã¾ã‚‹ç‰¹æ®Šè¡Œã¯ãã®ã¾ã¾
                if (line.startsWith('â€»') || line.startsWith('èª¬æ˜') || line.startsWith('URL')) {
                    if (line.includes('\t') || line.match(/^(èª¬æ˜|URL)\s/)) {
                        // ã‚¿ãƒ–ã‚„ã‚¹ãƒšãƒ¼ã‚¹ãŒã‚ã‚‹å ´åˆã¯åˆ†å‰²
                        let parts = line.split(/[\t\s]+/);
                        if (parts.length >= 2) {
                            formatted.push(`${parts[0]}ï¼š${parts.slice(1).join(' ')}`);
                        } else {
                            formatted.push('  ' + line);
                        }
                    } else {
                        formatted.push('  ' + line);
                    }
                    currentKey = null;
                    previousWasKey = false;
                    continue;
                }

                // ã‚¿ãƒ–åŒºåˆ‡ã‚Šã¾ãŸã¯ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã‚’æ¤œå‡ºï¼ˆæ¨ªä¸¦ã³ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
                let parts = [];
                if (line.includes('\t')) {
                    parts = line.split('\t').filter(p => p.trim());
                } else if (line.match(/\s{2,}/)) {
                    // è¤‡æ•°ã‚¹ãƒšãƒ¼ã‚¹ã§åˆ†å‰²
                    parts = line.split(/\s{2,}/).filter(p => p.trim());
                }

                // æ¨ªä¸¦ã³ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆé …ç›®åã¨å€¤ãŒåŒã˜è¡Œã«ã‚ã‚‹ï¼‰
                if (parts.length >= 2) {
                    const key = parts[0].trim();
                    const value = parts.slice(1).join(' ').trim();
                    formatted.push(`${key}ï¼š${value}`);
                    currentKey = null;
                    previousWasKey = false;
                    continue;
                }

                // ç¸¦ä¸¦ã³ãƒ‘ã‚¿ãƒ¼ãƒ³ã®åˆ¤å®š
                // æ¬¡ã®è¡ŒãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                const nextLine = i + 1 < lines.length ? lines[i + 1].trim() : null;
                
                // ç¾åœ¨ã®è¡ŒãŒé …ç›®åã‚‰ã—ã„ï¼ˆæ—¥æœ¬èªã§çµ‚ã‚ã‚‹ã€è¨˜å·ãŒãªã„ï¼‰
                const looksLikeKey = !line.match(/[0-9%]+$/) && 
                                      !line.match(/^https?:\/\//) && 
                                      !line.match(/è©²å½“ãªã—|åŒºåŸŸå†…|åŒºåŸŸå¤–|å®Œäº†/);

                // æ¬¡ã®è¡ŒãŒå€¤ã‚‰ã—ã„ï¼ˆæ•°å­—ã€è¨˜å·ã€URLã€çŸ­ã„æ–‡å­—åˆ—ï¼‰
                const nextLooksLikeValue = nextLine && 
                                           (nextLine.match(/^[0-9]+/) || 
                                            nextLine.match(/[%mh]/) || 
                                            nextLine.match(/^https?:\/\//) ||
                                            nextLine.match(/è©²å½“ãªã—|åŒºåŸŸå†…|åŒºåŸŸå¤–|å®Œäº†/) ||
                                            nextLine.length < 30);

                // ç¸¦ä¸¦ã³ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨åˆ¤å®š
                if (looksLikeKey && nextLooksLikeValue && !previousWasKey) {
                    currentKey = line;
                    previousWasKey = true;
                    continue;
                }

                // å‰ã®è¡ŒãŒé …ç›®åã§ã€ã“ã®è¡ŒãŒå€¤ã®å ´åˆ
                if (currentKey) {
                    formatted.push(`${currentKey}ï¼š${line}`);
                    currentKey = null;
                    previousWasKey = false;
                    continue;
                }

                // ã©ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚‚å½“ã¦ã¯ã¾ã‚‰ãªã„å ´åˆã¯ãã®ã¾ã¾è¿½åŠ 
                formatted.push(line);
                previousWasKey = false;
            }

            formattedText = formatted.join('\n');
            
            // çµæœã‚’è¡¨ç¤º
            const outputDiv = document.getElementById('formattedOutput');
            outputDiv.textContent = formattedText;
            outputDiv.style.display = 'block';
            
            // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¸€æ™‚çš„ã«éè¡¨ç¤º
            document.getElementById('copySuccess').style.display = 'none';
        }

        function copyFormatted() {
            if (!formattedText) {
                alert('ã¾ãšã€Œãƒ†ã‚­ã‚¹ãƒˆã‚’æ•´å½¢ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„');
                return;
            }

            // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
            navigator.clipboard.writeText(formattedText).then(() => {
                const successDiv = document.getElementById('copySuccess');
                successDiv.style.display = 'block';
                
                // 3ç§’å¾Œã«éè¡¨ç¤º
                setTimeout(() => {
                    successDiv.style.display = 'none';
                }, 3000);
            }).catch(err => {
                alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + err);
            });
        }
    </script>

    <script async
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAHSxrJMfGFM3i1fFnvLOIHNT53xXVSPQI&callback=initMap&libraries=places&v=weekly">
    </script>
</body>
</html>
